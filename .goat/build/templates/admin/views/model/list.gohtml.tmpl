{{- define "admin.views.model.list" -}}
{{- $ctx := . -}}
{{- $name := (index $ctx.Data (print .From ".entity")) -}}
{{- $entityName := (camelcaseuf $name) -}}
{{- $fieldsBaseKey := (print .From ".fields.") -}}
{{- $fields := (sort (keys $ctx.Data $fieldsBaseKey)) -}}
{{- $systemFields := (findRows $fieldsBaseKey "^[A-Za-z0-9]+$" ".system" "y" $ctx.Data) -}}
{{- $mainFields := (except $fields $systemFields) -}}

{{- noescape "{{- define \"content\" -}}" }}

{{ "{{" }} $prefix := (print .Lang ".view.admin.model.{{lower $name}}.list.") }}

<h1>{{$entityName}}</h1>

<div class="top-nav">
  {{- $hrefAttr := (print "href=\"/admin/" (lower $entityName) "/insert\"") }}
  <a type="button" class="btn btn-link" {{$hrefAttr|safeHTMLAttr}}>
    {{noescape "{{" }} TranslateFor "insert_btn" $prefix }}</a>
  </a>
</div>

{{ noescape "{{ if eq (len .Data.Collection) 0 -}}" }}
No data to show
{{ noescape "{{- else }}" }}
  <div class="admin-table">
    <div class="row">
      {{- range $i, $fieldkey := $mainFields -}}
      {{- $fieldName := (camelcaseuf (index $ctx.Data (print $fieldsBaseKey $fieldkey ".name"))) }}
        <div class="col">{{$fieldName}}</div>
      {{- end }}
      <div class="col">Actions</div>
    </div>
    {{- noescape "{{- " -}} range $i, $row := .Data.Collection }}
    <div class="row">
      {{- range $i, $fieldkey := $mainFields -}}
      {{- $fieldName := (camelcaseuf (index $ctx.Data (print $fieldsBaseKey $fieldkey ".name"))) }}
        <div class="col">{{- noescape "{{- " -}} $row.{{$fieldName}} -}}</div>
      {{- end }}
      <div class="col">
        {{- $hrefAttr := (print "href=\"/admin/" (lower $entityName) "/{{$row.ID}}\"") }}
        <a {{$hrefAttr|safeHTMLAttr}}>
          {{ noescape "{{" }} TranslateFor "edit_btn" $prefix }}
        </a>
        {{- $actionAttr := (print "action=\"/admin/" (lower $entityName) "/{{$row.ID}}$delete\"") }}
        <form method="POST" {{$actionAttr|safeHTMLAttr}}>
          {{- $valueAttr := "value=\"{{TranslateFor \"delete_btn\" $prefix}}\"" }}
          <input type="submit" {{$valueAttr|safeHTMLAttr}} />
        </form>
      </div>
    </div>
    {{ noescape "{{- end }}" }}
</div>
{{ noescape "{{- end }}" }}


{{ noescape "{{- end }}" }}
{{- end -}}
